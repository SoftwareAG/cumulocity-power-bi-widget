!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@c8y/ngx-components"),require("powerbi-client"),require("@c8y/client"),require("@angular/forms"),require("@ngx-translate/core"),require("rxjs"),require("@angular/router"),require("ngx-bootstrap/collapse")):"function"==typeof define&&define.amd?define("powerbi-runtime-widget",["exports","@angular/core","@c8y/ngx-components","powerbi-client","@c8y/client","@angular/forms","@ngx-translate/core","rxjs","@angular/router","ngx-bootstrap/collapse"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["powerbi-runtime-widget"]={},e.ng.core,e["@c8y/ngx-components"],e.pbiClient,e.client,e.ng.forms,e.core$1,e.rxjs,e.ng.router,e.collapse)}(this,(function(e,t,r,n,o,i,s,a,c,p){"use strict";function l(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var u=l(n);
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function d(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{c(n.next(e))}catch(e){i(e)}}function a(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))}function h(e,t){var r,n,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,n=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}Object.create;Object.create;var f=function(){function e(e,t){this.fetchClient=e,this.optionsService=t,this.path=null,this.path=this.optionsService.get("cdhContextPath")}return e.prototype.Get=function(e,t,r){return void 0===r&&(r={accept:"application/json"}),d(this,void 0,void 0,(function(){var n;return h(this,(function(o){return"GET",n={method:"GET",headers:r,params:t},[2,this.fetchClient.fetch(this.getEndPoint(e),n)]}))}))},e.prototype.Head=function(e,t,r){return void 0===r&&(r={accept:"application/json"}),d(this,void 0,void 0,(function(){var n;return h(this,(function(o){return"HEAD",n={method:"HEAD",headers:r,params:t},[2,this.fetchClient.fetch(this.getEndPoint(e),n)]}))}))},e.prototype.Post=function(e,t,r,n){return void 0===n&&(n={accept:"application/json"}),d(this,void 0,void 0,(function(){return h(this,(function(o){return[2,this.fetchClient.fetch(this.getEndPoint(e),{method:"POST",body:JSON.stringify(t),headers:n,params:r})]}))}))},e.prototype.Delete=function(e,t,r){return void 0===r&&(r={accept:"application/json"}),d(this,void 0,void 0,(function(){var n;return h(this,(function(o){return"DELETE",n={method:"DELETE",headers:r,params:t},[2,this.fetchClient.fetch(this.getEndPoint(e),n)]}))}))},e.prototype.getEndPoint=function(e){return this.path+e},e}();f.decorators=[{type:t.Injectable}],f.ctorParameters=function(){return[{type:o.FetchClient},{type:r.OptionsService}]};var m=function(){function e(t){this.http=t,this.path="/service/datahub/powerbi",this.configRequested=!1,this.cachedInfo=JSON.parse(JSON.stringify(e.cachedInfoDefault))}return e.prototype.setConfigRequestState=function(){this.configRequested=!0},e.prototype.getConfigRequestState=function(){return this.configRequested},e.prototype.getConfig=function(){return d(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return e=this.path+"/config",[4,this.http.Get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.save=function(e){return d(this,void 0,void 0,(function(){var t;return h(this,(function(r){switch(r.label){case 0:return t=this.path+"/config",[4,this.http.Post(t,e)];case 1:return[2,r.sent()]}}))}))},e.prototype.delete=function(){return d(this,void 0,void 0,(function(){var e,t;return h(this,(function(r){switch(r.label){case 0:return e=this.path+"/config",t={timeout:5e3},[4,this.http.Delete(e,t)];case 1:return[2,r.sent()]}}))}))},e.prototype.listWorkspaces=function(){return d(this,void 0,void 0,(function(){var e;return h(this,(function(t){switch(t.label){case 0:return e=this.path+"/groups",[4,this.http.Get(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.listReports=function(e){return d(this,void 0,void 0,(function(){var t,r;return h(this,(function(n){switch(n.label){case 0:return t=this.path+"/reports",r={groupId:e},[4,this.http.Get(t,r)];case 1:return[2,n.sent()]}}))}))},e.prototype.embedReport=function(e,t){return d(this,void 0,void 0,(function(){var r,n;return h(this,(function(o){switch(o.label){case 0:return r=this.path+"/embedReport",n={groupId:e,reportId:t},[4,this.http.Get(r,n)];case 1:return[2,o.sent()]}}))}))},e.prototype.flushCache=function(){this.cachedInfo=JSON.parse(JSON.stringify(e.cachedInfoDefault))},e}();m.cachedInfoDefault={reports:[],activeToken:"",settings:null},m.decorators=[{type:t.Injectable}],m.ctorParameters=function(){return[{type:f}]};var g=function(){function e(e,t){this.powerbiService=e,this.alertService=t,this.powerbi=new u.service.Service(u.factories.hpmFactory,u.factories.wpmpFactory,u.factories.routerFactory),this.workspaces=[],this.settingsNotDefined=!1,this.isLoading=!1,this.embedUrl="https://app.powerbi.com/reportEmbed"}return e.prototype.ngOnChanges=function(e){return d(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return e.embeddingInfo&&e.embeddingInfo.currentValue?[4,this.ngOnInit()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.ngOnInit=function(){return d(this,void 0,void 0,(function(){return h(this,(function(e){try{this.embedReport()}catch(e){this.alertService.danger("Failed to fetch embedding token.")}return[2]}))}))},e.prototype.embedReport=function(e,t,r,n){var o=this,i={type:"report",id:"1f7c1d48-10cd-4af6-89fc-6891347bb42f",embedUrl:"https://app.powerbi.com/reportEmbed?reportId=1f7c1d48-10cd-4af6-89fc-6891347bb42f&groupId=8341efa8-fe16-4402-a9f7-9f60edb11aff&w=2&config=eyJjbHVzdGVyVXJsIjoiaHR0cHM6Ly9XQUJJLVdFU1QtRVVST1BFLUItUFJJTUFSWS1yZWRpcmVjdC5hbmFseXNpcy53aW5kb3dzLm5ldCIsImVtYmVkRmVhdHVyZXMiOnsibW9kZXJuRW1iZWQiOnRydWUsImFuZ3VsYXJPbmx5UmVwb3J0RW1iZWQiOnRydWUsImNlcnRpZmllZFRlbGVtZXRyeUVtYmVkIjp0cnVlLCJ1c2FnZU1ldHJpY3NWTmV4dCI6dHJ1ZSwic2tpcFpvbmVQYXRjaCI6dHJ1ZX19",tokenType:u.models.TokenType.Embed,accessToken:"H4sIAAAAAAAEAB2Uxw6rWBZF_-VNKcmYTEk1AF9yzmFGuCaDSSa0-t_bXfM9ONprnf2fP3Z29VNW_vn7D1_jDRxWlvOajIq3fbX0FbkFWPNVW23noNHXcuC0C5tAue4OiFUz0MHouOudDSp5VVWS2QWPok6y5Fmveu2eR49SxmXbkgmk0WSKRPjAw0_eL-c7GfDmFRTcJDdQSOdWvAPSqUcENSy5HpULfjWzPkZoG7OTKdeDvP26eTfq23HLyrRe3_5d9BZmt9jytax0G09bOil33PJEc8axXyDpF-73eR6AeazMcLRhOPJ0NiKWoi5m7aWI2JfH6gSx9Jhd7cp7gzHUNn8Qkx-ICA-GiG3tD6D7yTT2SHSHMPcbdOnKr3hJwH2-FSZXkK9YrlWzBjRXbOT41t4FofL1aqQgfR5oR-mGBFSgNiG1vM-Y94W1rR7Z7c1e4oQWKks98GKkH50xj71z_SiH5tPfcnqjIFLcgLCZNzHpesV6gVmnIP9AupWsgAht5iTTmYvxEKRlelo9b68K7xK5-3r5Mv8g6hT_IGq1PLTJSrOOyy2_Z8kifc4ulwH-GXdUyULhaTC8_yKrDHAYT4nWjmFma3SYnmsZLdZNTr4HKu0RnQ2ExY2JBDSPmgFBMRRsWiQwXFJHudyyw0SUxhh523-AJhtrWjp9WeQOCYkQpkXbIdVJZnMHakpHV5SNFVXHppoUwEhGy2FeSkR0Aoz80ihDA3YN2CGmyGOPu0tZTpOz65Kg8tvqU5XRsShoyTft-iMIYTRmoiiXaTQn1TVEJv7NamCktEunqYuSNcofbYIvdaFgzWBe6z9__vrzWq7PNmnw-qmvUHc06v1KwfWrB4zCf60i1X2_VSC1J83ax1tRy2qjVcSrmLJLfMnz-bvHqxA8QpeQjnxD-xzjRKWYSxRP-Wi63MaOPBLLTlNopgy8xOf4mbBp5_V8RCjNdk2L7lD6IozY_J7hdVx-awIsUK0owFj-CI03pw6Ru9_lw3t9h6ifOqTiHjirXazTQORz2Y7n2gxktUh210GQvBmGnzaAET1yEoxJVK5J82HKcHKqUYp8_OQob7rGj4k9Z36rdF29bnR7J3tI7ivN8BRGSoxvLV3hpR4tsHzRR8ItYc-47m8tAUlHc9Ao8OVLpQGlKvOnUYz1B1Q2F2oR3K6tQhbHsMWrbfX459-ar08NFyX8tdxx4me0H_LFK4aMWFbw-caf6t-U11Rjtu0L_MWmGOtv-9RU3HaL0cKTtujrmo3fmhUqd6UoFembjtFRggaDgaEv8dA0ZTs8GtAEG-8moWFPy944sCshkREohv3WZiveCgAJXeiX7s5sPJ-LRiFzpoe7nX6J7HnyCuNQLSB-C0VNSVNDbnd8GrvLCeSYu9KhtWyIMhu-GxdL8jRucy6rtYfjS13vRWeCjQioZRS349YiUYiIgVUrt_7Z6jpH6qGsZNGBqTUEELy-FvhIyrr-7PMz1bgtgI8pcyuweIvx_CmDMLQVSEu8P22qsqele_kWSPJcaHVJGZr0yDHcfw0zQzcUdpwCDpiy9a4NHcPqyBiDiGz0DZJbvFADSYr6_zD--z-RGtQG7gUAAA==.eyJjbHVzdGVyVXJsIjoiaHR0cHM6Ly9XQUJJLVdFU1QtRVVST1BFLUItUFJJTUFSWS1yZWRpcmVjdC5hbmFseXNpcy53aW5kb3dzLm5ldCIsImVtYmVkRmVhdHVyZXMiOnsibW9kZXJuRW1iZWQiOmZhbHNlfX0=",settings:{filterPaneEnabled:!0,navContentPaneEnabled:!0,background:u.models.BackgroundType.Transparent}},s=this.reportContainer.nativeElement;this.powerbi.reset(s);var a=this.powerbi.embed(s,i);a.off("error"),a.on("error",(function(e){o.alertService.danger("Failed to embed report.")}))},e}();g.decorators=[{type:t.Component,args:[{selector:"lib-gp-powerbi-widget",template:'Hello Power BI\r\n<div>\r\n  <lib-gp-powerbi-config></lib-gp-powerbi-config>\r\n</div>\r\n<div class="card content-fullpage" >\r\n    <div class="d-flex d-col inner-scroll fit-h">\r\n    <div class="card-header separator sticky-top">\r\n        <h4>\r\n\t\t\t\t\x3c!-- We are doing some decoding of the report name due to the way we store the report name in the application \r\n\t\t\t\t\tDecoding may not be needed --\x3e\r\n            \x3c!-- {{\r\n          AppUtils.decodeUriComponent(reportName) !== reportName ?\r\n            AppUtils.decodeUriComponent(reportName) :\r\n            reportName\r\n            }} --\x3e\r\n            Power Bi Report\r\n        </h4>\r\n    </div>\r\n    <div class="flex-grow p-16">\r\n      <div class="powerbi-report" id="reportContainer" #reportContainer>\r\n        <c8y-loading></c8y-loading>\r\n      </div>\r\n    </div>\r\n    </div>\r\n</div>\r\n'}]}],g.ctorParameters=function(){return[{type:m},{type:r.AlertService}]},g.propDecorators={reportContainer:[{type:t.ViewChild,args:["reportContainer",{static:!0}]}],embeddingInfo:[{type:t.Input}],reportName:[{type:t.Input}]};var v=function(){function e(e,t,r){this.powerbiService=e,this.fb=t,this.translateService=r,this.workspaceIndex=0,this.isLoading=!1,this.onClose=new a.Subject,this.modalResult={workspaceId:null,report:null},this.error=""}return e.prototype.ngOnInit=function(){return d(this,void 0,void 0,(function(){var e,t,n=this;return h(this,(function(o){switch(o.label){case 0:return[4,this.powerbiService.getConfig()];case 1:return e=o.sent(),console.log("fetchReponse",e),[4,this.powerbiService.listWorkspaces()];case 2:return t=o.sent(),console.log("listWorkspaces",t),this.form=this.fb.group({workspace:this.fb.control(this.workspaces[0],i.Validators.required),report:this.fb.control(this.reports[0].length>0?this.reports[0][0]:null,i.Validators.required)}),this.visibleReports=this.reports[0],this.workspaces.slice(1,this.workspaces.length).forEach((function(){n.reports.push(null)})),this.form.controls.workspace.valueChanges.subscribe((function(e){return d(n,void 0,void 0,(function(){var t,n,o;return h(this,(function(i){switch(i.label){case 0:if(!((t=this.workspaces.findIndex((function(t){return t===e})))>=0))return[3,11];if(null!==this.reports[t])return[3,9];i.label=1;case 1:return i.trys.push([1,6,7,8]),this.error="",this.isLoading=!0,[4,this.powerbiService.listReports(this.workspaces[t].id)];case 2:return 200!==(n=i.sent()).status?[3,4]:[4,n.json()];case 3:if("SUCCEEDED"!==(o=i.sent()).status)throw Error();return this.reports[t]=o.data,this.reports[t].length>0?this.form.controls.report.setValue(this.reports[t][0]):this.form.controls.report.setValue(null),this.form.updateValueAndValidity(),[3,5];case 4:throw this.form.controls.report.setValue(null),Error();case 5:return[3,8];case 6:return i.sent(),this.error=this.translateService.instant(r.gettext("Fetching reports for workspace failed.")),[3,8];case 7:return this.isLoading=!1,[7];case 8:return[3,10];case 9:this.error="",this.form.controls.report.setValue(this.reports[t][0].id),i.label=10;case 10:this.visibleReports=this.reports[t],this.workspaceIndex=t,i.label=11;case 11:return[2]}}))}))})),[2]}}))}))},e.prototype.close=function(){},e.prototype.save=function(){this.modalResult.workspaceId=this.form.controls.workspace.value.id,this.modalResult.report=this.form.controls.report.value,this.modalResult.report.workspaceId=this.modalResult.workspaceId,this.onClose.next(this.modalResult)},e}();v.decorators=[{type:t.Component,args:[{selector:"lib-gp-powerbi-config",template:'<div class="viewport-modal">\n    <div class="modal-header dialog-header">\n      <i [c8yIcon]="\'graph-report\'"></i>\n      <h4>\n        {{\'Select report\' | translate}}\n      </h4>\n    </div>\n    <div class="p-16 text-center separator-bottom">\n      <p class="lead m-0">{{\'Select the workspace you want to access.\' | translate }}</p>\n      <p class="lead m-0">{{\'Select a report from the selected workspace.\' | translate }}</p>\n    </div>\n    <div class="modal-inner-scroll">\n      <div class="modal-body">\n        <form [formGroup]="form">\n          <c8y-form-group>\n            <label for="workspace">\n              {{\'Workspace\' | translate}}\n            </label>\n            <div class="c8y-select-wrapper">\n              <select formControlName="workspace"\n                      name="workspace"\n                      id="workspace">\n                <option *ngFor="let workspace of workspaces"\n                        [ngValue]="workspace">\n                  {{ workspace.name }}\n                </option>\n              </select>\n            </div>\n          </c8y-form-group>\n          <c8y-form-group>\n            <label for="report">\n              {{\'Report\' | translate }}\n            </label>\n            <div *ngIf="visibleReports?.length === 0 || error || isLoading; else reportsSelect">\n              <c8y-loading *ngIf="isLoading"></c8y-loading>\n              <em *ngIf="!error && !isLoading; else errorMessage"\n                  translate> No reports available for chosen workspace</em>\n              <ng-template #errorMessage>\n                <div *ngIf="error && !isLoading">\n                  <i [c8yIcon]="\'warning\'"\n                     class="m-r-4 text-danger"></i>\n                  <em>{{ error }}</em>\n                </div>\n              </ng-template>\n            </div>\n            <ng-template #reportsSelect>\n              <div class="c8y-select-wrapper">\n                <select formControlName="report"\n                        name="report"\n                        id="report">\n                  <option *ngFor="let report of visibleReports"\n                          [ngValue]="report">\n                    {{ report.name }}\n                  </option>\n                </select>\n              </div>\n            </ng-template>\n          </c8y-form-group>\n        </form>\n      </div>\n    </div>\n    <div class="modal-footer">\n      <button class="btn btn-default"\n              (click)="close()">{{ \'Cancel\' | translate }}</button>\n      <button [ngClass]="{\'btn-pending\': isLoading}"\n              class="btn btn-primary"\n              (click)="save()"\n              [disabled]="form.invalid">\n        {{\'Select\' | translate }}\n      </button>\n    </div>\n  </div>',styles:[""]}]}],v.ctorParameters=function(){return[{type:m},{type:i.FormBuilder},{type:s.TranslateService}]};var b={id:"powerbi.widget",label:"Power BI Widget",description:"Power BI Widget",component:g,configComponent:v,data:{ng1:{options:{noDeviceTarget:!0,noNewWidgets:!1,deviceTargetNotRequired:!0,groupsSelectable:!0}}}},y=function(){};y.decorators=[{type:t.NgModule,args:[{declarations:[g,v],imports:[r.CoreModule,p.CollapseModule,c.RouterModule,r.FormsModule,i.ReactiveFormsModule,r.ModalModule],providers:[f,m,{provide:r.HOOK_COMPONENTS,multi:!0,useValue:b}],exports:[g],entryComponents:[g]}]}],e.GpPowerbiWidgetModule=y,e["ɵ0"]=b,e["ɵa"]=g,e["ɵb"]=m,e["ɵc"]=f,e["ɵd"]=v,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=custom-widget.umd.min.js.map